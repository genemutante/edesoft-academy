<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o de Certifica√ß√µes | Academy</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
--primary:#4f46e5;
--border:#e2e8f0;
--bg:#f8fafc;
--text-main:#0f172a;
--text-muted:#64748b;
--white:#fff;
--view-blue:#2563eb;
--edit-purple:#7c3aed;
--delete-red:#dc2626;
}

*{box-sizing:border-box;font-family:Inter,sans-serif}

body{
margin:0;
background:var(--bg);
height:100vh;
display:flex;
flex-direction:column;
}

.app-header{
height:56px;
background:#fff;
border-bottom:1px solid var(--border);
display:flex;
align-items:center;
justify-content:space-between;
padding:0 24px;
}

.header-title{font-weight:800;color:var(--primary)}

#view-lista{flex:1;display:flex;flex-direction:column}

/* FILTROS */

.filter-bar{
width:100%;
background:#fff;
border-bottom:1px solid var(--border);
padding:12px 24px;
}

.filter-inner{
max-width:720px;
display:flex;
gap:12px;
flex-wrap:wrap;
align-items:flex-end;
}

.filter-group{
display:flex;
flex-direction:column;
gap:4px;
flex:1;
min-width:200px;
}

.filter-group label{
font-size:10px;
font-weight:700;
color:var(--text-muted);
text-transform:uppercase;
}

.search-input,.filter-select{
height:36px;
padding:0 10px;
border:1px solid var(--border);
border-radius:6px;
background:#f1f5f9;
}

.btn{
height:36px;
padding:0 16px;
border-radius:6px;
font-weight:700;
border:1px solid var(--border);
background:#fff;
cursor:pointer;
}

/* TABELA */

.table-container{flex:1;padding:16px 24px;overflow:auto}

table{
width:100%;
background:#fff;
border:1px solid var(--border);
border-radius:8px;
border-collapse:separate;
}

th{
background:#f8fafc;
padding:10px;
font-size:10px;
text-transform:uppercase;
color:var(--text-muted);
}

td{padding:8px}

.actions-cell{
display:flex;
justify-content:flex-end;
gap:4px;
white-space:nowrap;
}

.btn-action{
width:30px;height:30px;
border-radius:6px;
border:1px solid transparent;
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
}

.btn-view{background:#eff6ff;color:var(--view-blue)}
.btn-edit{background:#f5f3ff;color:var(--edit-purple)}
.btn-delete{background:#fef2f2;color:var(--delete-red)}

.badge{
font-size:10px;
padding:3px 6px;
border-radius:4px;
font-weight:700;
}

.type-cert{background:#e0e7ff;color:#4338ca}
.type-notorio{background:#fef3c7;color:#92400e}
</style>
</head>

<body>

<header class="app-header">
<div class="header-title">ACADEMY // GEST√ÉO DE CERTIFICA√á√ïES</div>
</header>

<div id="view-lista">

<div class="filter-bar">
<div class="filter-inner">

<div class="filter-group">
<label>Pesquisar colaborador ou curso</label>
<input id="searchBox" class="search-input" onkeyup="filtrar()" placeholder="Buscar colaborador ou curso...">
</div>

<div class="filter-group" style="flex:0">
<label>Tipo</label>
<select id="filterTipo" class="filter-select" onchange="filtrar()">
<option value="TODOS">Todos</option>
<option value="CERTIFICADO">Certificados</option>
<option value="NOTORIO">Not√≥rio Saber</option>
</select>
</div>

<div class="filter-group" style="flex:0">
<label style="opacity:0">x</label>
<button class="btn" onclick="limparFiltros()">LIMPAR</button>
</div>

</div>
</div>

<div class="table-container">
<table id="homologTable">
<thead>
<tr>
<th>Colaborador</th>
<th>Compet√™ncia</th>
<th>Tipo</th>
<th>Data</th>
<th>Nota</th>
<th style="text-align:right">A√ß√µes</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<script type="module">
import { DBHandler } from '../bd-treinamentos/db-handler.js';

let DADOS_LISTA=[];

window.carregarLista=async()=>{
DADOS_LISTA=await DBHandler.listarHomologacoes();
renderizarTabela(DADOS_LISTA);
};

function renderizarTabela(lista){
const tbody=document.querySelector("#homologTable tbody");
const session=JSON.parse(localStorage.getItem('rh_session')||'{}');

tbody.innerHTML=lista.map(i=>`
<tr>
<td><b>${i.colaboradores?.nome||'‚Äî'}</b></td>
<td>${i.treinamentos?.nome||'‚Äî'}</td>
<td><span class="badge ${i.atividade_externa==='NOTORIO'?'type-notorio':'type-cert'}">${i.atividade_externa}</span></td>
<td>${new Date(i.data_homologacao).toLocaleDateString('pt-BR')}</td>
<td>${i.nota||'N/A'}</td>
<td class="actions-cell">
<button class="btn-action btn-view" onclick="abrirFormulario(${i.id},true)">üëÅÔ∏è</button>
${session.role==='ADMIN'?`
<button class="btn-action btn-edit" onclick="abrirFormulario(${i.id},false)">‚úèÔ∏è</button>
<button class="btn-action btn-delete" onclick="deletarRegistro(${i.id})">üóëÔ∏è</button>`:''}
</td>
</tr>`).join('');
}

window.filtrar=()=>{
const b=searchBox.value.toLowerCase();
const t=filterTipo.value;
renderizarTabela(DADOS_LISTA.filter(i=>
((i.colaboradores?.nome||'').toLowerCase().includes(b)||
(i.treinamentos?.nome||'').toLowerCase().includes(b)) &&
(t==='TODOS'||i.atividade_externa===t)
));
};

window.limparFiltros=()=>{
searchBox.value='';
filterTipo.value='TODOS';
renderizarTabela(DADOS_LISTA);
};

carregarLista();
</script>

</body>
</html>
